!function (t,e) { "object" === typeof exports && "object" === typeof module ? module.exports = e() : "function" === typeof define && define.amd ? define([],e) : "object" === typeof exports ? exports.PingOneAuth = e() : t.PingOneAuth = e(); }(global,(function () { return function (t) { var e = {}; function r (n) { if (e[n]) { return e[n].exports; } var o = e[n] = {i: n,l: !1,exports: {}}; return t[n].call(o.exports,o,o.exports,r),o.l = !0,o.exports; } return r.m = t,r.c = e,r.d = function (t,e,n) { r.o(t,e) || Object.defineProperty(t,e,{enumerable: !0,get: n}); },r.r = function (t) { "undefined" !== typeof Symbol && Symbol.toStringTag && Object.defineProperty(t,Symbol.toStringTag,{value: "Module"}),Object.defineProperty(t,"__esModule",{value: !0}); },r.t = function (t,e) { if (1 & e && (t = r(t)),8 & e) { return t; } if (4 & e && "object" === typeof t && t && t.__esModule) { return t; } var n = Object.create(null); if (r.r(n),Object.defineProperty(n,"default",{enumerable: !0,value: t}),2 & e && "string" !== typeof t) { for (var o in t) { r.d(n,o,function (e) { return t[e]; }.bind(null,o)); } } return n; },r.n = function (t) { var e = t && t.__esModule ? function () { return t.default; } : function () { return t; }; return r.d(e,"a",e),e; },r.o = function (t,e) { return Object.prototype.hasOwnProperty.call(t,e); },r.p = "",r(r.s = 10); }([function (t,e) { t.exports = require("stream"); },function (t,e) { t.exports = require("zlib"); },function (t,e) { t.exports = require("url"); },function (t,e,r) { t.exports = r(11); },function (t,e) { function r (t,e,r,n,o,i,s) { try { var a = t[i](s),u = a.value; } catch (t) { return void r(t); }a.done ? e(u) : Promise.resolve(u).then(n,o); }t.exports = function (t) { return function () { var e = this,n = arguments; return new Promise((function (o,i) { var s = t.apply(e,n); function a (t) { r(s,o,i,a,u,"next",t); } function u (t) { r(s,o,i,a,u,"throw",t); }a(void 0); })); }; }; },function (t,e) { t.exports = function (t,e) { if (!(t instanceof e)) { throw new TypeError("Cannot call a class as a function"); } }; },function (t,e) { function r (t,e) { for (var r = 0; r < e.length; r++) { var n = e[r]; n.enumerable = n.enumerable || !1,n.configurable = !0,"value" in n && (n.writable = !0),Object.defineProperty(t,n.key,n); } }t.exports = function (t,e,n) { return e && r(t.prototype,e),n && r(t,n),t; }; },function (t,e) { t.exports = require("http"); },function (t,e,r) { var n = r(13),o = n.default || n,i = function (t,e) { return /^\/\//.test(t) && (t = `https:${t}`),o.call(this,t,e); }; t.exports = e = i,e.fetch = i,e.Headers = n.Headers,e.Request = n.Request,e.Response = n.Response,e.default = i; },function (t,e) { t.exports = require("https"); },function (t,e,r) { var n = r(3),o = r(4),i = r(5),s = r(6),a = r(12),u = function () { "use strict"; function t (e) { i(this,t),this.issuer = "".concat(e.AUTH_URI ? e.AUTH_URI : "https://auth.pingone.com","/").concat(e.environmentID,"/as"),e.issuer = this.issuer,this.apiUrl = "".concat(e.API_URI,"/v1/environments/").concat(e.environmentID),this.http = new a(e); } var e,r,u,c,l,f,p,h,d,y; return s(t,[{key: "addUser",value: (y = o(n.mark((function t (e,r,o) { var i; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return i = "".concat(this.apiUrl,"/users"),t.abrupt("return",this.http.postJson(i,{body: {email: e,username: r,population: {id: o}},headers: {"Content-type": "application/json"}})); case 2:case "end":return t.stop(); } } }),t,this); }))),function (t,e,r) { return y.apply(this,arguments); })},{key: "deleteUser",value: (d = o(n.mark((function t (e) { var r; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return r = "".concat(this.apiUrl,"/users/").concat(e),t.abrupt("return",this.http.delete(r,null)); case 2:case "end":return t.stop(); } } }),t,this); }))),function (t) { return d.apply(this,arguments); })},{key: "findUser",value: (h = o(n.mark((function t (e) { var r; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return r = "".concat(this.apiUrl,'/users?filter=email eq "').concat(e,'" or username eq "').concat(e,'"'),t.abrupt("return",this.http.getJson(r,null)); case 2:case "end":return t.stop(); } } }),t,this); }))),function (t) { return h.apply(this,arguments); })},{key: "getPopulations",value: (p = o(n.mark((function t () { var e; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return e = "".concat(this.apiUrl,"/populations"),t.abrupt("return",this.http.getJson(e,null)); case 2:case "end":return t.stop(); } } }),t,this); }))),function () { return p.apply(this,arguments); })},{key: "updateUser",value: (f = o(n.mark((function t (e,r,o) { var i; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return i = "".concat(this.apiUrl,"/users/").concat(e),t.abrupt("return",this.http.patchJson(i,{body: {name: {given: r,family: o}}})); case 2:case "end":return t.stop(); } } }),t,this); }))),function (t,e,r) { return f.apply(this,arguments); })},{key: "changePassword",value: (l = o(n.mark((function t (e,r,o) { var i; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return i = "".concat(this.apiUrl,"/users/").concat(e,"/password"),t.abrupt("return",this.http.putJson(i,{body: {currentPassword: r,newPassword: o},headers: {"Content-type": "application/vnd.pingidentity.password.reset+json"}})); case 2:case "end":return t.stop(); } } }),t,this); }))),function (t,e,r) { return l.apply(this,arguments); })},{key: "setPassword",value: (c = o(n.mark((function t (e,r) { var o,i,s = arguments; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return o = s.length > 2 && void 0 !== s[2] && s[2],i = "".concat(this.apiUrl,"/users/").concat(e,"/password"),t.abrupt("return",this.http.putJson(i,{body: {value: r,forceChange: o},headers: {"Content-type": "application/vnd.pingidentity.password.set+json"}})); case 3:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return c.apply(this,arguments); })},{key: "sendRecoveryCode",value: (u = o(n.mark((function t (e) { var r; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return r = "".concat(this.apiUrl,"/users/").concat(e,"/password"),t.abrupt("return",this.http.postJson(r,{headers: {"Content-type": "application/vnd.pingidentity.password.sendRecoveryCode+json"}})); case 2:case "end":return t.stop(); } } }),t,this); }))),function (t) { return u.apply(this,arguments); })},{key: "recoverPassword",value: (r = o(n.mark((function t (e,r,o) { var i; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return i = "".concat(this.apiUrl,"/users/").concat(e,"/password"),t.abrupt("return",this.http.postJson(i,{body: {recoveryCode: r,newPassword: o},headers: {"Content-type": "application/vnd.pingidentity.password.recover+json"}})); case 2:case "end":return t.stop(); } } }),t,this); }))),function (t,e,n) { return r.apply(this,arguments); })},{key: "getPasswordPattern",value: (e = o(n.mark((function t () { var e; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return e = "".concat(this.apiUrl,"/passwordPolicies"),t.abrupt("return",this.http.getJson(e,null).then((function (t) { var e = t._embedded.passwordPolicies.filter((function (t) { return !0 === t.default && t.minCharacters && t.maxRepeatedCharacters || "Standard" === t.name; })); if (e) { var r = "^(?:",n = e[0].minCharacters; for (var o in n) { r = "".concat(r,"(?=(?:.*[").concat(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]){").concat(n[o],",})"); } return r = "".concat(r,")(?!.*(.)\\1{").concat(e[0].maxRepeatedCharacters,",})"),r = "".concat(r,".{").concat(e[0].length.min,",").concat(e[0].length.max,"}$"); } }))); case 2:case "end":return t.stop(); } } }),t,this); }))),function () { return e.apply(this,arguments); })}]),t; }(); t.exports = u; },function (t,e,r) { var n = function (t) { "use strict"; var e = Object.prototype,r = e.hasOwnProperty,n = "function" === typeof Symbol ? Symbol : {},o = n.iterator || "@@iterator",i = n.asyncIterator || "@@asyncIterator",s = n.toStringTag || "@@toStringTag"; function a (t,e,r,n) { var o = e && e.prototype instanceof l ? e : l,i = Object.create(o.prototype),s = new j(n || []); return i._invoke = function (t,e,r) { var n = "suspendedStart"; return function (o,i) { if ("executing" === n) { throw new Error("Generator is already running"); } if ("completed" === n) { if ("throw" === o) { throw i; } return O(); } for (r.method = o,r.arg = i; ;) { var s = r.delegate; if (s) { var a = g(s,r); if (a) { if (a === c) { continue; } return a; } } if ("next" === r.method) { r.sent = r._sent = r.arg; } else if ("throw" === r.method) { if ("suspendedStart" === n) { throw n = "completed",r.arg; } r.dispatchException(r.arg); } else { "return" === r.method && r.abrupt("return",r.arg); } n = "executing"; var l = u(t,e,r); if ("normal" === l.type) { if (n = r.done ? "completed" : "suspendedYield",l.arg === c) { continue; } return {value: l.arg,done: r.done}; }"throw" === l.type && (n = "completed",r.method = "throw",r.arg = l.arg); } }; }(t,r,s),i; } function u (t,e,r) { try { return {type: "normal",arg: t.call(e,r)}; } catch (t) { return {type: "throw",arg: t}; } }t.wrap = a; var c = {}; function l () {} function f () {} function p () {} var h = {}; h[o] = function () { return this; }; var d = Object.getPrototypeOf,y = d && d(d(k([]))); y && y !== e && r.call(y,o) && (h = y); var m = p.prototype = l.prototype = Object.create(h); function b (t) { ["next","throw","return"].forEach((function (e) { t[e] = function (t) { return this._invoke(e,t); }; })); } function v (t,e) { var n; this._invoke = function (o,i) { function s () { return new e((function (n,s) { !function n (o,i,s,a) { var c = u(t[o],t,i); if ("throw" !== c.type) { var l = c.arg,f = l.value; return f && "object" === typeof f && r.call(f,"__await") ? e.resolve(f.__await).then((function (t) { n("next",t,s,a); }),(function (t) { n("throw",t,s,a); })) : e.resolve(f).then((function (t) { l.value = t,s(l); }),(function (t) { return n("throw",t,s,a); })); }a(c.arg); }(o,i,n,s); })); } return n = n ? n.then(s,s) : s(); }; } function g (t,e) { var r = t.iterator[e.method]; if (void 0 === r) { if (e.delegate = null,"throw" === e.method) { if (t.iterator.return && (e.method = "return",e.arg = void 0,g(t,e),"throw" === e.method)) { return c; } e.method = "throw",e.arg = new TypeError("The iterator does not provide a 'throw' method"); } return c; } var n = u(r,t.iterator,e.arg); if ("throw" === n.type) { return e.method = "throw",e.arg = n.arg,e.delegate = null,c; } var o = n.arg; return o ? o.done ? (e[t.resultName] = o.value,e.next = t.nextLoc,"return" !== e.method && (e.method = "next",e.arg = void 0),e.delegate = null,c) : o : (e.method = "throw",e.arg = new TypeError("iterator result is not an object"),e.delegate = null,c); } function w (t) { var e = {tryLoc: t[0]}; 1 in t && (e.catchLoc = t[1]),2 in t && (e.finallyLoc = t[2],e.afterLoc = t[3]),this.tryEntries.push(e); } function x (t) { var e = t.completion || {}; e.type = "normal",delete e.arg,t.completion = e; } function j (t) { this.tryEntries = [{tryLoc: "root"}],t.forEach(w,this),this.reset(!0); } function k (t) { if (t) { var e = t[o]; if (e) { return e.call(t); } if ("function" === typeof t.next) { return t; } if (!isNaN(t.length)) { var n = -1,i = function e () { for (;++n < t.length;) { if (r.call(t,n)) { return e.value = t[n],e.done = !1,e; } } return e.value = void 0,e.done = !0,e; }; return i.next = i; } } return {next: O}; } function O () { return {value: void 0,done: !0}; } return f.prototype = m.constructor = p,p.constructor = f,p[s] = f.displayName = "GeneratorFunction",t.isGeneratorFunction = function (t) { var e = "function" === typeof t && t.constructor; return Boolean(e) && (e === f || "GeneratorFunction" === (e.displayName || e.name)); },t.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t,p) : (t.__proto__ = p,s in t || (t[s] = "GeneratorFunction")),t.prototype = Object.create(m),t; },t.awrap = function (t) { return {__await: t}; },b(v.prototype),v.prototype[i] = function () { return this; },t.AsyncIterator = v,t.async = function (e,r,n,o,i) { void 0 === i && (i = Promise); var s = new v(a(e,r,n,o),i); return t.isGeneratorFunction(r) ? s : s.next().then((function (t) { return t.done ? t.value : s.next(); })); },b(m),m[s] = "Generator",m[o] = function () { return this; },m.toString = function () { return "[object Generator]"; },t.keys = function (t) { var e = []; for (var r in t) { e.push(r); } return e.reverse(),function r () { for (;e.length;) { var n = e.pop(); if (n in t) { return r.value = n,r.done = !1,r; } } return r.done = !0,r; }; },t.values = k,j.prototype = {constructor: j,reset: function (t) { if (this.prev = 0,this.next = 0,this.sent = this._sent = void 0,this.done = !1,this.delegate = null,this.method = "next",this.arg = void 0,this.tryEntries.forEach(x),!t) { for (var e in this) { "t" === e.charAt(0) && r.call(this,e) && !isNaN(Number(e.slice(1))) && (this[e] = void 0); } } },stop: function () { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) { throw t.arg; } return this.rval; },dispatchException: function (t) { if (this.done) { throw t; } var e = this; function n (r,n) { return s.type = "throw",s.arg = t,e.next = r,n && (e.method = "next",e.arg = void 0),Boolean(n); } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o],s = i.completion; if ("root" === i.tryLoc) { return n("end"); } if (i.tryLoc <= this.prev) { var a = r.call(i,"catchLoc"),u = r.call(i,"finallyLoc"); if (a && u) { if (this.prev < i.catchLoc) { return n(i.catchLoc,!0); } if (this.prev < i.finallyLoc) { return n(i.finallyLoc); } } else if (a) { if (this.prev < i.catchLoc) { return n(i.catchLoc,!0); } } else { if (!u) { throw new Error("try statement without catch or finally"); } if (this.prev < i.finallyLoc) { return n(i.finallyLoc); } } } } },abrupt: function (t,e) { for (var n = this.tryEntries.length - 1; n >= 0; --n) { var o = this.tryEntries[n]; if (o.tryLoc <= this.prev && r.call(o,"finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } }i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var s = i ? i.completion : {}; return s.type = t,s.arg = e,i ? (this.method = "next",this.next = i.finallyLoc,c) : this.complete(s); },complete: function (t,e) { if ("throw" === t.type) { throw t.arg; } return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg,this.method = "return",this.next = "end") : "normal" === t.type && e && (this.next = e),c; },finish: function (t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) { return this.complete(r.completion,r.afterLoc),x(r),c; } } },catch: function (t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; x(r); } return o; } } throw new Error("illegal catch attempt"); },delegateYield: function (t,e,r) { return this.delegate = {iterator: k(t),resultName: e,nextLoc: r},"next" === this.method && (this.arg = void 0),c; }},t; }(t.exports); try { regeneratorRuntime = n; } catch (t) { Function("r","regeneratorRuntime = r")(n); } },function (t,e,r) { var n = r(3),o = r(4),i = r(5),s = r(6),a = r(8),u = r(14),c = function () { "use strict"; function t (e) { i(this,t),this.oauth = new u(e); } var e,r,c,l,f,p,h,d,y,m,b; return s(t,[{key: "addAccessToken",value: (b = o(n.mark((function t (e) { var r,o; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:if (this.oauth) { t.next = 2; break; } return t.abrupt("return",Promise.resolve()); case 2:if (void 0 !== this.accessToken) { t.next = 12; break; } return t.next = 5,this.oauth.getAccessToken(); case 5:return r = t.sent,t.next = 8,this.errorFilter(r); case 8:return o = t.sent,t.next = 11,o.json(); case 11:this.accessToken = t.sent; case 12:e.headers.Authorization = "Bearer ".concat(this.accessToken.access_token); case 13:case "end":return t.stop(); } } }),t,this); }))),function (t) { return b.apply(this,arguments); })},{key: "errorFilter",value: (m = o(n.mark((function t (e) { var r; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:if (!(e.status >= 200 && e.status < 300)) { t.next = 4; break; } return t.abrupt("return",e); case 4:return t.next = 6,e.json(); case 6:throw r = t.sent,new Error(JSON.stringify(r)); case 8:case "end":return t.stop(); } } }),t); }))),function (t) { return m.apply(this,arguments); })},{key: "http",value: (y = o(n.mark((function t (e,r) { var o; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).method = r.method || "get",t.next = 4,this.addAccessToken(r); case 4:return t.next = 6,a(e,r); case 6:return o = t.sent,t.abrupt("return",this.errorFilter(o)); case 8:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return y.apply(this,arguments); })},{key: "delete",value: (d = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return t.abrupt("return",this.http(e,Object.assign(r || {},{method: "delete"}))); case 1:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return d.apply(this,arguments); })},{key: "json",value: (h = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).headers = Object.assign({Accept: "application/json"},r.headers),t.abrupt("return",this.http(e,r).then((function (t) { return t.json(); }))); case 3:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return h.apply(this,arguments); })},{key: "getJson",value: (p = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).method = "get",t.abrupt("return",this.json(e,r)); case 3:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return p.apply(this,arguments); })},{key: "post",value: (f = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).method = "post",t.abrupt("return",this.http(e,r)); case 3:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return f.apply(this,arguments); })},{key: "postJson",value: (l = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).method = "post",r.body = JSON.stringify(r.body),t.abrupt("return",this.json(e,r)); case 4:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return l.apply(this,arguments); })},{key: "patchJson",value: (c = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).method = "patch",r.body = JSON.stringify(r.body),t.abrupt("return",this.json(e,r)); case 4:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return c.apply(this,arguments); })},{key: "putJson",value: (r = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).method = "put",r.body = JSON.stringify(r.body),t.abrupt("return",this.json(e,r)); case 4:case "end":return t.stop(); } } }),t,this); }))),function (t,e) { return r.apply(this,arguments); })},{key: "put",value: (e = o(n.mark((function t (e,r) { return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return (r = r || {}).method = "put",t.abrupt("return",this.http(e,r)); case 3:case "end":return t.stop(); } } }),t,this); }))),function (t,r) { return e.apply(this,arguments); })}]),t; }(); t.exports = c; },function (t,e,r) { "use strict"; r.r(e),r.d(e,"Headers",(function () { return L; })),r.d(e,"Request",(function () { return N; })),r.d(e,"Response",(function () { return $; })),r.d(e,"FetchError",(function () { return p; })); var n = r(0),o = r(7),i = r(2),s = r(9),a = r(1); const u = n.Readable,c = Symbol("buffer"),l = Symbol("type"); class f {constructor () { this[l] = ""; const t = arguments[0],e = arguments[1],r = []; let n = 0; if (t) { const e = t,o = Number(e.length); for (let t = 0; t < o; t++) { const o = e[t]; let i; i = o instanceof Buffer ? o : ArrayBuffer.isView(o) ? Buffer.from(o.buffer,o.byteOffset,o.byteLength) : o instanceof ArrayBuffer ? Buffer.from(o) : o instanceof f ? o[c] : Buffer.from("string" === typeof o ? o : String(o)),n += i.length,r.push(i); } } this[c] = Buffer.concat(r); const o = e && void 0 !== e.type && String(e.type).toLowerCase(); o && !/[^\u0020-\u007E]/.test(o) && (this[l] = o); } get size () { return this[c].length; } get type () { return this[l]; }text () { return Promise.resolve(this[c].toString()); }arrayBuffer () { const t = this[c],e = t.buffer.slice(t.byteOffset,t.byteOffset + t.byteLength); return Promise.resolve(e); }stream () { const t = new u(); return t._read = function () {},t.push(this[c]),t.push(null),t; }toString () { return "[object Blob]"; }slice () { const t = this.size,e = arguments[0],r = arguments[1]; let n,o; n = void 0 === e ? 0 : e < 0 ? Math.max(t + e,0) : Math.min(e,t),o = void 0 === r ? t : r < 0 ? Math.max(t + r,0) : Math.min(r,t); const i = Math.max(o - n,0),s = this[c].slice(n,n + i),a = new f([],{type: arguments[2]}); return a[c] = s,a; }} function p (t,e,r) { Error.call(this,t),this.message = t,this.type = e,r && (this.code = this.errno = r.code),Error.captureStackTrace(this,this.constructor); }let h; Object.defineProperties(f.prototype,{size: {enumerable: !0},type: {enumerable: !0},slice: {enumerable: !0}}),Object.defineProperty(f.prototype,Symbol.toStringTag,{value: "Blob",writable: !1,enumerable: !1,configurable: !0}),p.prototype = Object.create(Error.prototype),p.prototype.constructor = p,p.prototype.name = "FetchError"; try { h = require("encoding").convert; } catch (t) {} const d = Symbol("Body internals"),y = n.PassThrough; function m (t) { var e = this,r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {},o = r.size; const i = void 0 === o ? 0 : o; var s = r.timeout; const a = void 0 === s ? 0 : s; null == t ? t = null : v(t) ? t = Buffer.from(t.toString()) : g(t) || Buffer.isBuffer(t) || ("[object ArrayBuffer]" === Object.prototype.toString.call(t) ? t = Buffer.from(t) : ArrayBuffer.isView(t) ? t = Buffer.from(t.buffer,t.byteOffset,t.byteLength) : t instanceof n || (t = Buffer.from(String(t)))),this[d] = {body: t,disturbed: !1,error: null},this.size = i,this.timeout = a,t instanceof n && t.on("error",(function (t) { const r = "AbortError" === t.name ? t : new p(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t); e[d].error = r; })); } function b () { var t = this; if (this[d].disturbed) { return m.Promise.reject(new TypeError(`body used already for: ${this.url}`)); } if (this[d].disturbed = !0,this[d].error) { return m.Promise.reject(this[d].error); } let e = this.body; if (null === e) { return m.Promise.resolve(Buffer.alloc(0)); } if (g(e) && (e = e.stream()),Buffer.isBuffer(e)) { return m.Promise.resolve(e); } if (!(e instanceof n)) { return m.Promise.resolve(Buffer.alloc(0)); } let r = [],o = 0,i = !1; return new m.Promise((function (n,s) { let a; t.timeout && (a = setTimeout((function () { i = !0,s(new p(`Response timeout while trying to fetch ${t.url} (over ${t.timeout}ms)`,"body-timeout")); }),t.timeout)),e.on("error",(function (e) { "AbortError" === e.name ? (i = !0,s(e)) : s(new p(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e)); })),e.on("data",(function (e) { if (!i && null !== e) { if (t.size && o + e.length > t.size) { return i = !0,void s(new p(`content size at ${t.url} over limit: ${t.size}`,"max-size")); } o += e.length,r.push(e); } })),e.on("end",(function () { if (!i) { clearTimeout(a); try { n(Buffer.concat(r,o)); } catch (e) { s(new p(`Could not create Buffer from response body for ${t.url}: ${e.message}`,"system",e)); } } })); })); } function v (t) { return "object" === typeof t && "function" === typeof t.append && "function" === typeof t.delete && "function" === typeof t.get && "function" === typeof t.getAll && "function" === typeof t.has && "function" === typeof t.set && ("URLSearchParams" === t.constructor.name || "[object URLSearchParams]" === Object.prototype.toString.call(t) || "function" === typeof t.sort); } function g (t) { return "object" === typeof t && "function" === typeof t.arrayBuffer && "string" === typeof t.type && "function" === typeof t.stream && "function" === typeof t.constructor && "string" === typeof t.constructor.name && /^(Blob|File)$/.test(t.constructor.name) && /^(Blob|File)$/.test(t[Symbol.toStringTag]); } function w (t) { let e,r,o = t.body; if (t.bodyUsed) { throw new Error("cannot clone body after it is used"); } return o instanceof n && "function" !== typeof o.getBoundary && (e = new y(),r = new y(),o.pipe(e),o.pipe(r),t[d].body = e,o = r),o; } function x (t) { return null === t ? null : "string" === typeof t ? "text/plain;charset=UTF-8" : v(t) ? "application/x-www-form-urlencoded;charset=UTF-8" : g(t) ? t.type || null : Buffer.isBuffer(t) || "[object ArrayBuffer]" === Object.prototype.toString.call(t) || ArrayBuffer.isView(t) ? null : "function" === typeof t.getBoundary ? `multipart/form-data;boundary=${t.getBoundary()}` : t instanceof n ? null : "text/plain;charset=UTF-8"; } function j (t) { const e = t.body; return null === e ? 0 : g(e) ? e.size : Buffer.isBuffer(e) ? e.length : e && "function" === typeof e.getLengthSync && (e._lengthRetrievers && 0 == e._lengthRetrievers.length || e.hasKnownLength && e.hasKnownLength()) ? e.getLengthSync() : null; }m.prototype = {get body () { return this[d].body; },get bodyUsed () { return this[d].disturbed; },arrayBuffer () { return b.call(this).then((function (t) { return t.buffer.slice(t.byteOffset,t.byteOffset + t.byteLength); })); },blob () { const t = this.headers && this.headers.get("content-type") || ""; return b.call(this).then((function (e) { return Object.assign(new f([],{type: t.toLowerCase()}),{[c]: e}); })); },json () { var t = this; return b.call(this).then((function (e) { try { return JSON.parse(e.toString()); } catch (e) { return m.Promise.reject(new p(`invalid json response body at ${t.url} reason: ${e.message}`,"invalid-json")); } })); },text () { return b.call(this).then((function (t) { return t.toString(); })); },buffer () { return b.call(this); },textConverted () { var t = this; return b.call(this).then((function (e) { return function (t,e) { if ("function" !== typeof h) { throw new Error("The package `encoding` must be installed to use the textConverted() function"); } const r = e.get("content-type"); let n,o,i = "utf-8"; r && (n = /charset=([^;]*)/i.exec(r)); o = t.slice(0,1024).toString(),!n && o && (n = /<meta.+?charset=(['"])(.+?)\1/i.exec(o)); !n && o && (n = /<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o),n && (n = /charset=(.*)/i.exec(n.pop()))); !n && o && (n = /<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o)); n && (i = n.pop(),"gb2312" !== i && "gbk" !== i || (i = "gb18030")); return h(t,"UTF-8",i).toString(); }(e,t.headers); })); }},Object.defineProperties(m.prototype,{body: {enumerable: !0},bodyUsed: {enumerable: !0},arrayBuffer: {enumerable: !0},blob: {enumerable: !0},json: {enumerable: !0},text: {enumerable: !0}}),m.mixIn = function (t) { for (const e of Object.getOwnPropertyNames(m.prototype)) { if (!(e in t)) { const r = Object.getOwnPropertyDescriptor(m.prototype,e); Object.defineProperty(t,e,r); } } },m.Promise = global.Promise; const k = /[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,O = /[^\t\x20-\x7e\x80-\xff]/; function T (t) { if (t = String(t),k.test(t) || "" === t) { throw new TypeError(`${t} is not a legal HTTP header name`); } } function S (t) { if (t = `${t}`,O.test(t)) { throw new TypeError(`${t} is not a legal HTTP header value`); } } function P (t,e) { e = e.toLowerCase(); for (const r in t) { if (r.toLowerCase() === e) { return r; } } } const E = Symbol("map"); class L {constructor () { const t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : void 0; if (this[E] = Object.create(null),t instanceof L) { const e = t.raw(),r = Object.keys(e); for (const t of r) { for (const r of e[t]) { this.append(t,r); } } } else if (null == t) { } else { if ("object" !== typeof t) { throw new TypeError("Provided initializer must be an object"); } { const e = t[Symbol.iterator]; if (null != e) { if ("function" !== typeof e) { throw new TypeError("Header pairs must be iterable"); } const r = []; for (const e of t) { if ("object" !== typeof e || "function" !== typeof e[Symbol.iterator]) { throw new TypeError("Each header pair must be iterable"); } r.push(Array.from(e)); } for (const t of r) { if (2 !== t.length) { throw new TypeError("Each header pair must be a name/value tuple"); } this.append(t[0],t[1]); } } else { for (const e of Object.keys(t)) { const r = t[e]; this.append(e,r); } } } } }get (t) { T(t = String(t)); const e = P(this[E],t); return void 0 === e ? null : this[E][e].join(", "); }forEach (t) { let e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : void 0,r = C(this),n = 0; for (;n < r.length;) { var o = r[n]; const i = o[0],s = o[1]; t.call(e,s,i,this),r = C(this),n++; } }set (t,e) { e = `${e}`,T(t = String(t)),S(e); const r = P(this[E],t); this[E][void 0 !== r ? r : t] = [e]; }append (t,e) { e = `${e}`,T(t = `${t}`),S(e); const r = P(this[E],t); void 0 !== r ? this[E][r].push(e) : this[E][t] = [e]; }has (t) { return T(t = `${t}`),void 0 !== P(this[E],t); }delete (t) { T(t = `${t}`); const e = P(this[E],t); void 0 !== e && delete this[E][e]; }raw () { return this[E]; }keys () { return _(this,"key"); }values () { return _(this,"value"); }[Symbol.iterator] () { return _(this,"key+value"); }} function C (t) { const e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "key+value"; const r = Object.keys(t[E]).sort(); return r.map("key" === e ? function (t) { return t.toLowerCase(); } : "value" === e ? function (e) { return t[E][e].join(", "); } : function (e) { return [e.toLowerCase(),t[E][e].join(", ")]; }); }L.prototype.entries = L.prototype[Symbol.iterator],Object.defineProperty(L.prototype,Symbol.toStringTag,{value: "Headers",writable: !1,enumerable: !1,configurable: !0}),Object.defineProperties(L.prototype,{get: {enumerable: !0},forEach: {enumerable: !0},set: {enumerable: !0},append: {enumerable: !0},has: {enumerable: !0},delete: {enumerable: !0},keys: {enumerable: !0},values: {enumerable: !0},entries: {enumerable: !0}}); const B = Symbol("internal"); function _ (t,e) { const r = Object.create(U); return r[B] = {target: t,kind: e,index: 0},r; } const U = Object.setPrototypeOf({next () { if (!this || Object.getPrototypeOf(this) !== U) { throw new TypeError("Value of `this` is not a HeadersIterator"); } var t = this[B]; const e = t.target,r = t.kind,n = t.index,o = C(e,r); return n >= o.length ? {value: void 0,done: !0} : (this[B].index = n + 1,{value: o[n],done: !1}); }},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]()))); function A (t) { const e = Object.assign({__proto__: null},t[E]),r = P(t[E],"Host"); return void 0 !== r && (e[r] = e[r][0]),e; }Object.defineProperty(U,Symbol.toStringTag,{value: "HeadersIterator",writable: !1,enumerable: !1,configurable: !0}); const R = Symbol("Response internals"),z = o.STATUS_CODES; class $ {constructor () { const t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null,e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; m.call(this,t,e); const r = e.status || 200,n = new L(e.headers); if (null != t && !n.has("Content-Type")) { const e = x(t); e && n.append("Content-Type",e); } this[R] = {url: e.url,status: r,statusText: e.statusText || z[r],headers: n,counter: e.counter}; } get url () { return this[R].url || ""; } get status () { return this[R].status; } get ok () { return this[R].status >= 200 && this[R].status < 300; } get redirected () { return this[R].counter > 0; } get statusText () { return this[R].statusText; } get headers () { return this[R].headers; }clone () { return new $(w(this),{url: this.url,status: this.status,statusText: this.statusText,headers: this.headers,ok: this.ok,redirected: this.redirected}); }}m.mixIn($.prototype),Object.defineProperties($.prototype,{url: {enumerable: !0},status: {enumerable: !0},ok: {enumerable: !0},redirected: {enumerable: !0},statusText: {enumerable: !0},headers: {enumerable: !0},clone: {enumerable: !0}}),Object.defineProperty($.prototype,Symbol.toStringTag,{value: "Response",writable: !1,enumerable: !1,configurable: !0}); const I = Symbol("Request internals"),q = i.parse,F = i.format,H = "destroy" in n.Readable.prototype; function J (t) { return "object" === typeof t && "object" === typeof t[I]; } class N {constructor (t) { let e,r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; J(t) ? e = q(t.url) : (e = t && t.href ? q(t.href) : q(`${t}`),t = {}); let n = r.method || t.method || "GET"; if (n = n.toUpperCase(),(null != r.body || J(t) && null !== t.body) && ("GET" === n || "HEAD" === n)) { throw new TypeError("Request with GET/HEAD method cannot have body"); } const o = null != r.body ? r.body : J(t) && null !== t.body ? w(t) : null; m.call(this,o,{timeout: r.timeout || t.timeout || 0,size: r.size || t.size || 0}); const i = new L(r.headers || t.headers || {}); if (null != o && !i.has("Content-Type")) { const t = x(o); t && i.append("Content-Type",t); }let s = J(t) ? t.signal : null; if ("signal" in r && (s = r.signal),null != s && !function (t) { const e = t && "object" === typeof t && Object.getPrototypeOf(t); return !(!e || "AbortSignal" !== e.constructor.name); }(s)) { throw new TypeError("Expected signal to be an instanceof AbortSignal"); } this[I] = {method: n,redirect: r.redirect || t.redirect || "follow",headers: i,parsedURL: e,signal: s},this.follow = void 0 !== r.follow ? r.follow : void 0 !== t.follow ? t.follow : 20,this.compress = void 0 !== r.compress ? r.compress : void 0 === t.compress || t.compress,this.counter = r.counter || t.counter || 0,this.agent = r.agent || t.agent; } get method () { return this[I].method; } get url () { return F(this[I].parsedURL); } get headers () { return this[I].headers; } get redirect () { return this[I].redirect; } get signal () { return this[I].signal; }clone () { return new N(this); }} function G (t) { Error.call(this,t),this.type = "aborted",this.message = t,Error.captureStackTrace(this,this.constructor); }m.mixIn(N.prototype),Object.defineProperty(N.prototype,Symbol.toStringTag,{value: "Request",writable: !1,enumerable: !1,configurable: !0}),Object.defineProperties(N.prototype,{method: {enumerable: !0},url: {enumerable: !0},headers: {enumerable: !0},redirect: {enumerable: !0},clone: {enumerable: !0},signal: {enumerable: !0}}),G.prototype = Object.create(Error.prototype),G.prototype.constructor = G,G.prototype.name = "AbortError"; const D = n.PassThrough,M = i.resolve; function V (t,e) { if (!V.Promise) { throw new Error("native promise missing, set fetch.Promise to your favorite alternative"); } return m.Promise = V.Promise,new V.Promise((function (r,i) { const u = new N(t,e),c = function (t) { const e = t[I].parsedURL,r = new L(t[I].headers); if (r.has("Accept") || r.set("Accept","*/*"),!e.protocol || !e.hostname) { throw new TypeError("Only absolute URLs are supported"); } if (!/^https?:$/.test(e.protocol)) { throw new TypeError("Only HTTP(S) protocols are supported"); } if (t.signal && t.body instanceof n.Readable && !H) { throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8"); } let o = null; if (null == t.body && /^(POST|PUT)$/i.test(t.method) && (o = "0"),null != t.body) { const e = j(t); "number" === typeof e && (o = String(e)); }o && r.set("Content-Length",o),r.has("User-Agent") || r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),t.compress && !r.has("Accept-Encoding") && r.set("Accept-Encoding","gzip,deflate"); let i = t.agent; return "function" === typeof i && (i = i(e)),r.has("Connection") || i || r.set("Connection","close"),Object.assign({},e,{method: t.method,headers: A(r),agent: i}); }(u),l = ("https:" === c.protocol ? s : o).request,f = u.signal; let h = null; const d = function () { const t = new G("The user aborted a request."); i(t),u.body && u.body instanceof n.Readable && u.body.destroy(t),h && h.body && h.body.emit("error",t); }; if (f && f.aborted) { return void d(); } const y = function () { d(),v(); },m = l(c); let b; function v () { m.abort(),f && f.removeEventListener("abort",y),clearTimeout(b); }f && f.addEventListener("abort",y),u.timeout && m.once("socket",(function (t) { b = setTimeout((function () { i(new p(`network timeout at: ${u.url}`,"request-timeout")),v(); }),u.timeout); })),m.on("error",(function (t) { i(new p(`request to ${u.url} failed, reason: ${t.message}`,"system",t)),v(); })),m.on("response",(function (t) { clearTimeout(b); const e = function (t) { const e = new L(); for (const r of Object.keys(t)) { if (!k.test(r)) { if (Array.isArray(t[r])) { for (const n of t[r]) { O.test(n) || (void 0 === e[E][r] ? e[E][r] = [n] : e[E][r].push(n)); } } else { O.test(t[r]) || (e[E][r] = [t[r]]); } } } return e; }(t.headers); if (V.isRedirect(t.statusCode)) { const n = e.get("Location"),o = null === n ? null : M(u.url,n); switch (u.redirect) { case "error":return i(new p(`redirect mode is set to error: ${u.url}`,"no-redirect")),void v(); case "manual":if (null !== o) { try { e.set("Location",o); } catch (t) { i(t); } } break; case "follow":if (null === o) { break; } if (u.counter >= u.follow) { return i(new p(`maximum redirect reached at: ${u.url}`,"max-redirect")),void v(); } const n = {headers: new L(u.headers),follow: u.follow,counter: u.counter + 1,agent: u.agent,compress: u.compress,method: u.method,body: u.body,signal: u.signal,timeout: u.timeout}; return 303 !== t.statusCode && u.body && null === j(u) ? (i(new p("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void v()) : (303 !== t.statusCode && (301 !== t.statusCode && 302 !== t.statusCode || "POST" !== u.method) || (n.method = "GET",n.body = void 0,n.headers.delete("content-length")),r(V(new N(o,n))),void v()); } }t.once("end",(function () { f && f.removeEventListener("abort",y); })); let n = t.pipe(new D()); const o = {url: u.url,status: t.statusCode,statusText: t.statusMessage,headers: e,size: u.size,timeout: u.timeout,counter: u.counter},s = e.get("Content-Encoding"); if (!u.compress || "HEAD" === u.method || null === s || 204 === t.statusCode || 304 === t.statusCode) { return h = new $(n,o),void r(h); } const c = {flush: a.Z_SYNC_FLUSH,finishFlush: a.Z_SYNC_FLUSH}; if ("gzip" == s || "x-gzip" == s) { return n = n.pipe(a.createGunzip(c)),h = new $(n,o),void r(h); } if ("deflate" != s && "x-deflate" != s) { if ("br" == s && "function" === typeof a.createBrotliDecompress) { return n = n.pipe(a.createBrotliDecompress()),h = new $(n,o),void r(h); } h = new $(n,o),r(h); } else { t.pipe(new D()).once("data",(function (t) { n = 8 == (15 & t[0]) ? n.pipe(a.createInflate()) : n.pipe(a.createInflateRaw()),h = new $(n,o),r(h); })); } })),function (t,e) { const r = e.body; null === r ? t.end() : g(r) ? r.stream().pipe(t) : Buffer.isBuffer(r) ? (t.write(r),t.end()) : r.pipe(t); }(m,u); })); }V.isRedirect = function (t) { return 301 === t || 302 === t || 303 === t || 307 === t || 308 === t; },V.Promise = global.Promise,e.default = V; },function (t,e,r) { var n = r(3),o = r(4),i = r(5),s = r(6),a = r(8),u = function () { "use strict"; function t (e) { i(this,t),this.httpConfig = e; } var e; return s(t,[{key: "getAccessToken",value: (e = o(n.mark((function t () { var e,r; return n.wrap((function (t) { for (;;) { switch (t.prev = t.next) { case 0:return e = {grant_type: "client_credentials",scope: this.httpConfig.scopes,client_id: this.httpConfig.clientID,client_secret: this.httpConfig.clientSecret},r = Object.entries(e).map((function (t) { return "".concat(encodeURIComponent(t[0]),"=").concat(encodeURIComponent(t[1])); })).join("&"),t.abrupt("return",a("".concat(this.httpConfig.issuer,"/token"),{method: "POST",body: r,headers: {Accept: "application/json","Content-Type": "application/x-www-form-urlencoded"}})); case 3:case "end":return t.stop(); } } }),t,this); }))),function () { return e.apply(this,arguments); })}]),t; }(); t.exports = u; }]); }));
// # sourceMappingURL=nodejs-sdk-api.min.js.map
